#textdomain wesnoth-The_Haunted_Woods
# The give gold menu option

#define GOLD_GIVE_OPTION GOLD_AMOUNT
	[option]
		message={MENU_IMG_TXT lobby/status-lobby-s.png (<big><b><span foreground='green'>{GOLD_AMOUNT}</span></b></big>)}
		[command]
			{VARIABLE_OP give_gold_amount add {GOLD_AMOUNT}}
		[/command]
	[/option]
#enddef

#define GOLD_GIVE
	# I should just use 1 menu for all players
    [event]
        name=start
        [set_menu_item]
            id=give_gold1   
            description= _ "Give gold"
			image=misc/dot-white.png
            [show_if]
                [variable]
                    name=side_number
                    equals=1
                [/variable]
                [have_unit]
                    x=$x1
                    y=$y1
                    side=1
                    canrecruit=yes
                [/have_unit]
            [/show_if]
            [command]
                [store_side]
                    side=$unit.side
                    variable=side_info
                [/store_side]
				{THW_STORE_PLAYER_INFO}
				{VARIABLE give_gold_amount 0}
				{VARIABLE finished no}
                [message]
                    speaker=unit
                    message= _ "Whom do you want to give gold to?"
                    [option]
                        message= _ {MENU_IMG_TXT ($stored_side_2.image) ($stored_side_2.name)}
						[show_if]
							[variable]
								name=player_2	
								equals=yes
							[/variable]
						[/show_if]
                        [command]
							[while]
								[variable]
									name=finished
									equals=no
								[/variable]
								[do]
		                            [message]
		                                speaker=unit
		                                message= _ "How much?"
										[option]
											message={MENU_IMG_TXT ($stored_side_2.image) ( _ "<big><b><span foreground='blue'>Transfer gold to $stored_side_2.name|: <u>$give_gold_amount|</u></span></b></big>")}
											[command]
												{VARIABLE finished yes}
					                            [if]
					                                [variable]
					                                    name=side_info.gold
					                                    greater_than_equal_to=$give_gold_amount
					                                [/variable]
					                                [then]
					                                    [gold]
					                                        side=$unit.side
					                                        amount=-$give_gold_amount
					                                    [/gold]
					                                    [gold]
					                                        side=2
					                                        amount=$give_gold_amount
					                                    [/gold]
					                                    {PRINT_THW ($stored_side_1.name|  has given $stored_side_2.name|  $give_gold_amount|  coins)}
					                                [/then]
					                                [else]
					                                    {NARRATOR_MESSAGE_THW $unit.side (You don't have $give_gold_amount| coins)}
					                                [/else]
					                            [/if]	
											[/command]
										[/option]
										[option]
											message={MENU_IMG_TXT misc/red-x.png ( _ "<big><b><span foreground='red'>Cancel transfer to $stored_side_2.name|</span></b></big>")}
											[command]
												{VARIABLE finished yes}
											[/command]
										[/option]
										{GOLD_GIVE_OPTION 1}
										{GOLD_GIVE_OPTION 5}
										{GOLD_GIVE_OPTION 10}
										{GOLD_GIVE_OPTION 20}
										{GOLD_GIVE_OPTION 30}
		                            [/message]
								[/do]
							[/while]
                        [/command]
                    [/option]
                    [option]
                        message= _ {MENU_IMG_TXT ($stored_side_3.image) ($stored_side_3.name)}
						[show_if]
							[variable]
								name=player_3
								equals=yes
							[/variable]
						[/show_if]
                        [command]
							[while]
								[variable]
									name=finished
									equals=no
								[/variable]
								[do]
		                            [message]
		                                speaker=unit
		                                message= _ "How much?"
										[option]
											message={MENU_IMG_TXT ($stored_side_3.image) ( _ "<big><b><span foreground='blue'>Transfer gold to $stored_side_3.name|: <u>$give_gold_amount|</u></span></b></big>")}
											[command]
												{VARIABLE finished yes}
					                            [if]
					                                [variable]
					                                    name=side_info.gold
					                                    greater_than_equal_to=$give_gold_amount
					                                [/variable]
					                                [then]
					                                    [gold]
					                                        side=$unit.side
					                                        amount=-$give_gold_amount
					                                    [/gold]
					                                    [gold]
					                                        side=3
					                                        amount=$give_gold_amount
					                                    [/gold]
					                                    {PRINT_THW ($stored_side_1.name|  has given $stored_side_3.name|  $give_gold_amount|  coins)}
					                                [/then]
					                                [else]
					                                    {NARRATOR_MESSAGE_THW $unit.side (You don't have $give_gold_amount| coins)}
					                                [/else]
					                            [/if]	
											[/command]
										[/option]
										[option]
											message={MENU_IMG_TXT misc/red-x.png ( _ "<big><b><span foreground='red'>Cancel transfer to $stored_side_3.name|</span></b></big>")}
											[command]
												{VARIABLE finished yes}
											[/command]
										[/option]
										{GOLD_GIVE_OPTION 1}
										{GOLD_GIVE_OPTION 5}
										{GOLD_GIVE_OPTION 10}
										{GOLD_GIVE_OPTION 20}
										{GOLD_GIVE_OPTION 30}
		                            [/message]
								[/do]
							[/while]
                        [/command]
                    [/option]
                    [option]
                        message= _ "Neither deserve any gold."
                    [/option]
                [/message]
            [/command]
        [/set_menu_item]
    [/event]

    [event]
        name=start
        [set_menu_item]
            id=give_gold2
            description= _ "Give gold"
			image=misc/dot-white.png
            [show_if]
                [variable]
                    name=side_number
                    equals=2
                [/variable]
                [variable]
                    name=thw_players.length
                    greater_than=1
                [/variable]
                [have_unit]
                    x=$x1
                    y=$y1
                    side=2
                    canrecruit=yes
                [/have_unit]
            [/show_if]
            [command]
                [store_side]
                    side=$unit.side
                    variable=side_info
                [/store_side]
				{THW_STORE_PLAYER_INFO}
				{VARIABLE give_gold_amount 0}
				{VARIABLE finished no}
                [message]
                    speaker=unit
                    message= _ "Whom do you want to give gold to?"
                    [option]
                        message= _ {MENU_IMG_TXT ($stored_side_1.image) ($stored_side_1.name)}
						[show_if]
							[variable]
								name=player_1
								equals=yes
							[/variable]
						[/show_if]
                        [command]
							[while]
								[variable]
									name=finished
									equals=no
								[/variable]
								[do]
		                            [message]
		                                speaker=unit
		                                message= _ "How much?"
										[option]
											message={MENU_IMG_TXT ($stored_side_1.image) ( _ "<big><b><span foreground='blue'>Transfer gold to $stored_side_1.name|: <u>$give_gold_amount|</u></span></b></big>")}
											[command]
												{VARIABLE finished yes}
					                            [if]
					                                [variable]
					                                    name=side_info.gold
					                                    greater_than_equal_to=$give_gold_amount
					                                [/variable]
					                                [then]
					                                    [gold]
					                                        side=$unit.side
					                                        amount=-$give_gold_amount
					                                    [/gold]
					                                    [gold]
					                                        side=1
					                                        amount=$give_gold_amount
					                                    [/gold]
					                                    {PRINT_THW ($stored_side_2.name|  has given $stored_side_1.name|  $give_gold_amount| coins)}
					                                [/then]
					                                [else]
					                                    {NARRATOR_MESSAGE_THW $unit.side (You don't have $give_gold_amount| coins)}
					                                [/else]
					                            [/if]	
											[/command]
										[/option]
										[option]
											message={MENU_IMG_TXT misc/red-x.png ( _ "<big><b><span foreground='red'>Cancel transfer of gold to $stored_side_1.name|</span></b></big>")}
											[command]
												{VARIABLE finished yes}
											[/command]
										[/option]
										{GOLD_GIVE_OPTION 1}
										{GOLD_GIVE_OPTION 5}
										{GOLD_GIVE_OPTION 10}
										{GOLD_GIVE_OPTION 20}
										{GOLD_GIVE_OPTION 30}
		                            [/message]
								[/do]
							[/while]
                        [/command]
                    [/option]
                    [option]
                        message= _ {MENU_IMG_TXT ($stored_side_3.image) ($stored_side_3.name)}
						[show_if]
							[variable]
								name=player_3
								equals=yes
							[/variable]
						[/show_if]
                        [command]
							[while]
								[variable]
									name=finished
									equals=no
								[/variable]
								[do]
		                            [message]
		                                speaker=unit
		                                message= _ "How much?"
										[option]
											message={MENU_IMG_TXT ($stored_side_3.image) ( _ "<big><b><span foreground='blue'>Transfer gold to $stored_side_3.name|: <u>$give_gold_amount|</u></span></b></big>")}
											[command]
												{VARIABLE finished yes}
					                            [if]
					                                [variable]
					                                    name=side_info.gold
					                                    greater_than_equal_to=$give_gold_amount
					                                [/variable]
					                                [then]
					                                    [gold]
					                                        side=$unit.side
					                                        amount=-$give_gold_amount
					                                    [/gold]
					                                    [gold]
					                                        side=3
					                                        amount=$give_gold_amount
					                                    [/gold]
					                                    {PRINT_THW ($stored_side_2.name|  has given $stored_side_3.name|  $give_gold_amount| coins)}
					                                [/then]
					                                [else]
					                                    {NARRATOR_MESSAGE_THW $unit.side (You don't have $give_gold_amount| coins)}
					                                [/else]
					                            [/if]	
											[/command]
										[/option]
										[option]
											message={MENU_IMG_TXT misc/red-x.png ( _ "<big><b><span foreground='red'>Cancel transfer to $stored_side_3.name|</span></b></big>")}
											[command]
												{VARIABLE finished yes}
											[/command]
										[/option]
										{GOLD_GIVE_OPTION 1}
										{GOLD_GIVE_OPTION 5}
										{GOLD_GIVE_OPTION 10}
										{GOLD_GIVE_OPTION 20}
										{GOLD_GIVE_OPTION 30}
		                            [/message]
								[/do]
							[/while]
                        [/command]
                    [/option]
                    [option]
                        message= _ "Neither deserve any gold."
                    [/option]
                [/message]
            [/command]
        [/set_menu_item]
    [/event]

    [event]
        name=start
        [set_menu_item]
            id=give_gold3
            description= _ "Give gold"
			image=misc/dot-white.png
            [show_if]
                [variable]
                    name=side_number
                    equals=3
                [/variable]
                [variable]
                    name=thw_players.length
                    greater_than=1
                [/variable]
                [have_unit]
                    x=$x1
                    y=$y1
                    side=3
                    canrecruit=yes
                [/have_unit]
            [/show_if]
            [command]
                [store_side]
                    side=$unit.side
                    variable=side_info
                [/store_side]
				{THW_STORE_PLAYER_INFO}
				{VARIABLE give_gold_amount 0}
				{VARIABLE finished no}
                [message]
                    speaker=unit
                    message= _ "Whom do you want to give gold to?"
                    [option]
                        message= _ {MENU_IMG_TXT ($stored_side_1.image) ($stored_side_1.name)}
						[show_if]
							[variable]
								name=player_1
								equals=yes
							[/variable]
						[/show_if]
                        [command]
							[while]
								[variable]
									name=finished
									equals=no
								[/variable]
								[do]
		                            [message]
		                                speaker=unit
		                                message= _ "How much?"
										[option]
											message={MENU_IMG_TXT ($stored_side_1.image) ( _ "<big><b><span foreground='blue'>Transfer gold to $stored_side_1.name|: <u>$give_gold_amount|</u></span></b></big>")}
											[command]
												{VARIABLE finished yes}
					                            [if]
					                                [variable]
					                                    name=side_info.gold
					                                    greater_than_equal_to=$give_gold_amount
					                                [/variable]
					                                [then]
					                                    [gold]
					                                        side=$unit.side
					                                        amount=-$give_gold_amount
					                                    [/gold]
					                                    [gold]
					                                        side=1
					                                        amount=$give_gold_amount
					                                    [/gold]
					                                    {PRINT_THW ($stored_side_3.name|  has given $stored_side_1.name|  $give_gold_amount| coins)}
					                                [/then]
					                                [else]
					                                    {NARRATOR_MESSAGE_THW $unit.side (You don't have $give_gold_amount| coins)}
					                                [/else]
					                            [/if]	
											[/command]
										[/option]
										[option]
											message={MENU_IMG_TXT misc/red-x.png ( _ "<big><b><span foreground='red'>Cancel transfer to $stored_side_1.name|</span></b></big>")}
											[command]
												{VARIABLE finished yes}
											[/command]
										[/option]
										{GOLD_GIVE_OPTION 1}
										{GOLD_GIVE_OPTION 5}
										{GOLD_GIVE_OPTION 10}
										{GOLD_GIVE_OPTION 20}
										{GOLD_GIVE_OPTION 30}
		                            [/message]
								[/do]
							[/while]
                        [/command]
                    [/option]
                    [option]
                        message= _ {MENU_IMG_TXT ($stored_side_2.image) ($stored_side_2.name)}
						[show_if]
							[variable]
								name=player_2
								equals=yes
							[/variable]
						[/show_if]
                        [command]
							[while]
								[variable]
									name=finished
									equals=no
								[/variable]
								[do]
		                            [message]
		                                speaker=unit
		                                message= _ "How much?"
										[option]
											message={MENU_IMG_TXT ($stored_side_2.image) ( _ "<big><b><span foreground='blue'>Transfer gold to $stored_side_2.name|: <u>$give_gold_amount|</u></span></b></big>")}
											[command]
												{VARIABLE finished yes}
					                            [if]
					                                [variable]
					                                    name=side_info.gold
					                                    greater_than_equal_to=$give_gold_amount
					                                [/variable]
					                                [then]
					                                    [gold]
					                                        side=$unit.side
					                                        amount=-$give_gold_amount
					                                    [/gold]
					                                    [gold]
					                                        side=2
					                                        amount=$give_gold_amount
					                                    [/gold]
					                                    {PRINT_THW ($stored_side_3.name|  has given $stored_side_2.name|  $give_gold_amount| coins)}
					                                [/then]
					                                [else]
					                                    {NARRATOR_MESSAGE_THW $unit.side (You don't have $give_gold_amount| coins)}
					                                [/else]
					                            [/if]	
											[/command]
										[/option]
										[option]
											message={MENU_IMG_TXT misc/red-x.png ( _ "<big><b><span foreground='red'>Cancel transfer to $stored_side_2.name|</span></b></big>")}
											[command]
												{VARIABLE finished yes}
											[/command]
										[/option]
										{GOLD_GIVE_OPTION 1}
										{GOLD_GIVE_OPTION 5}
										{GOLD_GIVE_OPTION 10}
										{GOLD_GIVE_OPTION 20}
										{GOLD_GIVE_OPTION 30}
		                            [/message]
								[/do]
							[/while]
                        [/command]
                    [/option]
                    [option]
                        message= _ "Neither deserve any gold."
                    [/option]
                [/message]
            [/command]
        [/set_menu_item]
    [/event]
#enddef

# The give unit menu option

#define UNIT_GIVE
    [event]
        name=start
        first_time_only=yes
        [set_menu_item]
            id=unitlend1
            description= _ "Give a Unit"
			image=misc/dot-white.png
            [show_if]
                [variable]
                    name=side_number
                    equals=1
                [/variable]
                [variable]
                    name=thw_players.length
                    greater_than=1
                [/variable]
                [have_unit]
                    x=$x1
                    y=$y1
                    canrecruit=yes
                    side=1
                [/have_unit]
            [/show_if]
            [command]
                {PRINT_THW ( _ "Now, right-click on the unit you want to give and select 'Give this Unit.'")}
                {VARIABLE fioril_give 1}
            [/command]
        [/set_menu_item]
    [/event]
    [event]
        name=start
        first_time_only=yes
        [set_menu_item]
            id=giveunitlend1
            description= _ "Give this Unit"
			image=misc/new-journey.png
            [show_if]
                [variable]
                    name=side_number
                    equals=1
                [/variable]
                [variable]
                    name=fioril_give
                    equals=1
                [/variable]
                [have_unit]
                    x=$x1
                    y=$y1
                    side=1
                    [not]
                        canrecruit=yes
                        x=$x1
                        y=$y1
                    [/not]
                    [not]
                        x=$x1
                        y=$y1
						[filter_wml]
							[variables]
								given_this_turn=yes
							[/variables]
						[/filter_wml]
                    [/not]
                [/have_unit]
            [/show_if]
            [command]
                {CLEAR_VARIABLE lend_unit}
                [store_unit]
                    [filter]
                        x=$x1
                        y=$y1
                        side=1
                    [/filter]
                    variable=lend_unit
                [/store_unit]
				{THW_STORE_PLAYER_INFO}
                [message]
                    canrecruit=yes
                    side=1
                    message= _ "Who deserves $lend_unit.name, $lend_unit.type?"
                    [option]
                        message= _ {MENU_IMG_TXT ($stored_side_2.image) ($stored_side_2.name)}
                        [show_if]
                            [variable]
                                name=player_2
                                equals=yes
                            [/variable]
                        [/show_if]
                        [command]
                            [message]
                                speaker=$lend_unit.id
                                message= _ "I am now yours to command, $stored_side_2.name|."
                            [/message]
                            {MODIFY_UNIT id=$lend_unit.id side 2}
                            {MODIFY_UNIT id=$lend_unit.id variables.given_moves $lend_unit.moves}
                            {MODIFY_UNIT id=$lend_unit.id variables.given_attacks_left $lend_unit.attacks_left}
                            {MODIFY_UNIT id=$lend_unit.id variables.given_this_turn yes}
                        [/command]
                    [/option]
                    [option]
                        message= _ {MENU_IMG_TXT ($stored_side_3.image) ($stored_side_3.name)}
                        [show_if]
                            [variable]  
                                name=player_3
                                equals=yes
                            [/variable]
                        [/show_if]
                        [command]
                            [message]
                                speaker=$lend_unit.id
                                message= _ "I am now yours to command, $stored_side_3.name|."
                            [/message]
                            {MODIFY_UNIT id=$lend_unit.id side 3}
                            {MODIFY_UNIT id=$lend_unit.id variables.given_moves $lend_unit.moves}
                            {MODIFY_UNIT id=$lend_unit.id variables.given_attacks_left $lend_unit.attacks_left}
                            {MODIFY_UNIT id=$lend_unit.id variables.given_this_turn yes}
                        [/command]
                    [/option]
                    [option]
                        message= _ "Neither deserve $lend_unit.name"
                        [command]
                        [/command]
                    [/option]
                [/message]
                {CLEAR_VARIABLE fioril_give}
            [/command]
        [/set_menu_item]
    [/event]
    [event]
        name=start
        first_time_only=yes
        [set_menu_item]
            id=unitlend2
            description= _ "Give a Unit"
			image=misc/dot-white.png
            [show_if]
                [variable]
                    name=side_number
                    equals=2
                [/variable]
                [variable]
                    name=thw_players.length
                    greater_than=1
                [/variable]
                [have_unit]
                    x=$x1
                    y=$y1
                    canrecruit=yes
                    side=2
                [/have_unit]
            [/show_if]
            [command]
                {PRINT_THW ( _ "Now, right-click on the unit you want to give and select 'Give this Unit.'")}
                {VARIABLE aigatus_give 1}
            [/command]
        [/set_menu_item]
    [/event]
    [event]
        name=start
        first_time_only=yes
        [set_menu_item]
            id=giveunitlend2
            description= _ "Give this Unit"
			image=misc/new-journey.png
            [show_if]
                [variable]
                    name=side_number
                    equals=2
                [/variable]
                [variable]
                    name=aigatus_give
                    equals=1
                [/variable]
                [have_unit]
                    x=$x1
                    y=$y1
                    side=2
                    [not]
                        canrecruit=yes
                        x=$x1
                        y=$y1
                    [/not]
                    [not]
						[filter_wml]
							[variables]
								given_this_turn=yes
							[/variables]
						[/filter_wml]
                    [/not]
                [/have_unit]    
            [/show_if]
            [command]
                {CLEAR_VARIABLE lend_unit2}
                [store_unit]
                    [filter]
                        x=$x1
                        y=$y1
                        side=2
                    [/filter]
                    variable=lend_unit2
                [/store_unit]
				{THW_STORE_PLAYER_INFO}
                [message]
                    canrecruit=yes
                    side=2
                    message= _ "Who deserves $lend_unit2.name, $lend_unit2.type?"
                    [option]
                        message= _ {MENU_IMG_TXT ($stored_side_1.image) ($stored_side_1.name)}
                        [show_if]
                            [variable]
                                name=player_1
                                equals=yes
                            [/variable] 
                        [/show_if]
                        [command]
                            [message]
                                speaker=$lend_unit2.id
                                message= _ "I am now yours to command, $stored_side_1.name|."
                            [/message]
                            {MODIFY_UNIT id=$lend_unit2.id side 1}
                            {MODIFY_UNIT id=$lend_unit2.id variables.given_moves $lend_unit.moves}
                            {MODIFY_UNIT id=$lend_unit2.id variables.given_attacks_left $lend_unit.attacks_left}
                            {MODIFY_UNIT id=$lend_unit2.id variables.given_this_turn yes}
                        [/command]
                    [/option]
                    [option]
                        message= _ {MENU_IMG_TXT ($stored_side_3.image) ($stored_side_3.name)}
                        [show_if]
                            [variable]  
                                name=player_3
                                equals=yes
                            [/variable]
                        [/show_if]
                        [command]
                            [message]
                                speaker=$lend_unit2.id
                                message= _ "I am now yours to command, $stored_side_3.name|."
                            [/message]
                            {MODIFY_UNIT id=$lend_unit2.id side 3}
                            {MODIFY_UNIT id=$lend_unit2.id variables.given_moves $lend_unit.moves}
                            {MODIFY_UNIT id=$lend_unit2.id variables.given_attacks_left $lend_unit.attacks_left}
                            {MODIFY_UNIT id=$lend_unit2.id variables.given_this_turn yes}
                        [/command]
                    [/option]
                    [option]
                        message= _ "Neither deserve $lend_unit2.name"
                        [command]
                        [/command]
                    [/option]
                [/message]
                {CLEAR_VARIABLE aigatus_give}
            [/command]
        [/set_menu_item]
    [/event]
    [event]
        name=start
        first_time_only=yes
        [set_menu_item]
            id=unitlend3
            description= _ "Give a Unit"
			image=misc/dot-white.png
            [show_if]
                [variable]
                    name=side_number
                    equals=3
                [/variable]
                [variable]
                    name=thw_players.length
                    greater_than=1
                [/variable]
                [have_unit]
                    x=$x1
                    y=$y1
                    canrecruit=yes
                    side=3
                [/have_unit]
            [/show_if]
            [command]
                {PRINT_THW ( _ "Now, right-click on the unit you want to give and select 'Give This Unit.'")}
                {VARIABLE cariddry_give 1}
            [/command]
        [/set_menu_item]
    [/event]
    [event]
        name=start
        first_time_only=yes
        [set_menu_item]
            id=giveunitlend3
            description= _ "Give this Unit"
			image=misc/new-journey.png
            [show_if]
                [variable]
                    name=side_number
                    equals=3
                [/variable]
                [variable]
                    name=cariddry_give
                    equals=1
                [/variable]
                [have_unit]
                    x=$x1
                    y=$y1
                    side=3
                    [not]
                        canrecruit=yes
                        x=$x1
                        y=$y1
                    [/not]
                    [not]
						[filter_wml]
							[variables]
								given_this_turn=yes
							[/variables]
						[/filter_wml]
                    [/not]
                [/have_unit]
            [/show_if]
            [command]
                {CLEAR_VARIABLE lend_unit3}
				[store_unit]
					[filter]
						x,y=$x1,$y1
						side=3
					[/filter]
					variable=lend_unit3
				[/store_unit]
				{THW_STORE_PLAYER_INFO}
                [message]
                    canrecruit=yes
                    side=3
                    message= _ "Who deserves $lend_unit3.name, $lend_unit3.type?"
                    [option]
                        message= _ {MENU_IMG_TXT ($stored_side_1.image) ($stored_side_1.name)}
                        [show_if]
                            [variable]
                                name=player_1
                                equals=yes
                            [/variable] 
                        [/show_if]
                        [command]
                            [message]
                                speaker=$lend_unit3.id
                                message= _ "I am now yours to command, $stored_side_1.name|."
                            [/message]
                            {MODIFY_UNIT id=$lend_unit3.id side 1}
                            {MODIFY_UNIT id=$lend_unit3.id variables.given_moves $lend_unit.moves}
                            {MODIFY_UNIT id=$lend_unit3.id variables.given_attacks_left $lend_unit.attacks_left}
                            {MODIFY_UNIT id=$lend_unit3.id variables.given_this_turn yes}
                        [/command]
                    [/option]
                    [option]
                        message= _ {MENU_IMG_TXT ($stored_side_2.image) ($stored_side_2.name)}
                        [show_if]
                            [variable]
                                name=player_2
                                equals=yes
                            [/variable]
                        [/show_if]
                        [command]
                            [message]
                                speaker=$lend_unit3.id
                                message= _ "I am now yours to command, $stored_side_2.name|."
                            [/message]
                            {MODIFY_UNIT id=$lend_unit3.id side 2}
                            {MODIFY_UNIT id=$lend_unit3.id variables.given_moves $lend_unit.moves}
                            {MODIFY_UNIT id=$lend_unit3.id variables.given_attacks_left $lend_unit.attacks_left}
                            {MODIFY_UNIT id=$lend_unit3.id variables.given_this_turn yes}
                        [/command]
                    [/option]
                    [option]
                        message= _ "Neither deserve $lend_unit3.name"
                        [command]
                        [/command]
                    [/option]
                [/message]
                {CLEAR_VARIABLE carridry_give}
            [/command]
        [/set_menu_item]
    [/event]
#enddef

#define USE_POTION_MENU
	[option]
	    message= _ "Use a potion"
	    [show_if]
	        [variable]
	            name=side_number
	            equals=$side_number
	        [/variable]
	        [variable]
	            name=$side_number|total_potions
	            greater_than=0
	        [/variable]
	        [have_unit]
	            x=$x1
	            y=$y1
	            side=$side_number
	        [/have_unit]
	    [/show_if]
	    [command]
	        [store_unit]
	            [filter]
	                x=$x1
	                y=$y1
	            [/filter]
	            variable=stored_potion_user
	        [/store_unit]
	        [message]
	            speaker=unit
	            message= _ "What potion should I use?" + {POTION_INFO}
	            [option]
	                message= _ "<b>None.</b>"
	                [command]
	                [/command]
	            [/option]
	            [option]
	                message= _ {MENU_IMG_TXT items/potion-red.png ( _ "Use a heal potion: instant full heal")}
	                [show_if]
	                    [variable]  
	                        name=$side_number|heal_potions
	                        greater_than=0
	                    [/variable]
	                    [variable]
	                        name=stored_potion_user.hitpoints
	                        not_equals=$stored_potion_user.max_hitpoints
	                    [/variable]
	                [/show_if]
	                [command]
	                    {VARIABLE_OP $side_number|total_potions add -1}
	                    {VARIABLE_OP $side_number|heal_potions add -1}
	                    {VARIABLE stored_potion_user.hitpoints $stored_potion_user.max_hitpoints}
	                    [unstore_unit]
	                        variable=stored_potion_user
	                        {COLOR_HEAL}
	                        text= _ "healed"
	                    [/unstore_unit]
	                [/command]
	            [/option]
	            [option]
	            message= _ {MENU_IMG_TXT items/potion-blue.png ( _ "Use an intelligence potion: +6 experience")}
	                [show_if]
	                    [variable]  
	                        name=$side_number|intelligence_potions
	                        greater_than=0
	                    [/variable]
	                [/show_if]
	                [command]
	                    {VARIABLE_OP $side_number|total_potions add -1}
	                    {VARIABLE_OP $side_number|intelligence_potions add -1}
	                    {VARIABLE_OP stored_potion_user.experience add 6}
	                    [unstore_unit]
	                        variable=stored_potion_user
	                        {COLOR_HEAL}
	                        text= _ "+6 xp"
	                    [/unstore_unit]
	                [/command]
	            [/option]
	            [option]
	            message= _ {MENU_IMG_TXT items/potion-yellow.png ( _ "Use a strength potion: +6 power")}
	                [show_if]
	                    [variable]  
	                        name=$side_number|strength_potions
	                        greater_than=0
	                    [/variable]
						[variable]
							name=unit.variables.using_strength_potion
							not_equals=yes
						[/variable]
	                [/show_if]
	                [command]
	                    [unstore_unit]
	                        variable=stored_potion_user
	                    [/unstore_unit]
	                    [object]
	                        silent=yes
	                        [effect]
	                            apply_to=attack
	                            increase_damage=6
	                        [/effect]
	                    [/object]
	                    {VARIABLE_OP $side_number|total_potions add -1}
	                    {VARIABLE_OP $side_number|strength_potions add -1}
	                    [store_unit]
	                        [filter]
	                            x=$x1
	                            y=$y1
	                        [/filter]
	                        variable=stored_potion_user
	                    [/store_unit]
	                    {VARIABLE stored_potion_user.variables.using_strength_potion yes}
	                    [unstore_unit]
	                        variable=stored_potion_user
	                        {COLOR_HEAL}
	                        text= _ "+6 power"
	                    [/unstore_unit]
	                [/command]
	            [/option]
	            [option]
	            message= _ {MENU_IMG_TXT items/potion-grey.png ( _ "Use a speed potion: +15 moves")}
	                [show_if]
	                    [variable]  
	                        name=$side_number|speed_potions
	                        greater_than=0
	                    [/variable]
	                [/show_if]
	                [command]
	                    {VARIABLE_OP $side_number|total_potions add -1}
	                    {VARIABLE_OP $side_number|speed_potions add -1}
	                    {VARIABLE_OP stored_potion_user.moves add 15}
	                    [unstore_unit]
	                        variable=stored_potion_user
	                        {COLOR_HEAL}
	                        text= _ "+15 moves"
	                    [/unstore_unit]
	                [/command]
	            [/option]
	            [option]
	            message= _ {MENU_IMG_TXT items/potion-poison.png ( _ "Use a poison potion: poison on all attacks")}
	                [show_if]
	                    [variable]  
	                        name=$side_number|poison_potions
	                        greater_than=0
	                    [/variable]
	                [/show_if]
	                [command]
	                    [unstore_unit]
	                        variable=stored_potion_user
	                    [/unstore_unit]
	                    [object]
	                        silent=yes
	                        [effect]
	                            apply_to=attack
	                            [set_specials]
	                                mode=append
	                                {WEAPON_SPECIAL_POISON}
	                            [/set_specials]
	                        [/effect]
	                    [/object]
	                    {VARIABLE_OP $side_number|total_potions add -1}
	                    {VARIABLE_OP $side_number|poison_potions add -1}
	                    [store_unit]
	                        [filter]
	                            x=$x1
	                            y=$y1
	                        [/filter]
	                        variable=stored_potion_user
	                    [/store_unit]
	                    [unstore_unit]
	                        variable=stored_potion_user
	                        {COLOR_HARM}
	                        text= _ "posion"
	                    [/unstore_unit]
	                [/command]
	            [/option]
	        [/message]
	    [/command]
	[/option]
#enddef

#define POTGIVE_OPTION IMAGE POTNAME SIDE_FROM SIDE_FOR
    [option]
        message= _ {MENU_IMG_TXT {IMAGE} ( _ "Give potion of {POTNAME}")}
        [show_if]
            [variable]
                name={SIDE_FROM}{POTNAME}_potions
                greater_than=0
            [/variable]
        [/show_if]
        [command]
            {VARIABLE_OP {SIDE_FROM}total_potions add -1}
            {VARIABLE_OP {SIDE_FROM}{POTNAME}_potions add -1}
            {VARIABLE_OP {SIDE_FOR}total_potions add 1}
            {VARIABLE_OP {SIDE_FOR}{POTNAME}_potions add 1}
            {PRINT_THW ( _ "$stored_side_{SIDE_FROM}.name|  has given $stored_side_{SIDE_FOR}.name|  a potion of {POTNAME}")}
        [/command]
    [/option]
#enddef

#define GIVE_POTION_1
    [option]
        message= _ "Give potion"
        [show_if]
            [variable]
                name=side_number
                equals=1
            [/variable]
            [variable]
                name=thw_players.length
                greater_than=1
            [/variable]
            [variable]
                name=1total_potions
                greater_than=0
            [/variable]
            [have_unit]
                x=$x1
                y=$y1
                canrecruit=yes
                side=1
            [/have_unit]
        [/show_if]
        [command]
			{THW_STORE_PLAYER_INFO}
            [message]
                speaker=unit
                message= _ "Who deserves a potion?"
                [option]
                    message= _ "Nobody"
                    [command]
                    [/command]
                [/option]
                [option]
                    message= _ {MENU_IMG_TXT $stored_side_2.image ($stored_side_2.name)}
                    [show_if]
                        [variable]
                            name=player_2
                            equals=yes
                        [/variable]
                    [/show_if]
                    [command]
                        [message]
                            speaker=unit
                            message= _ "What potion does $stored_side_2.name| deserve?" + {POTION_INFO}
                            [option]
                                message= _ "None"
                                [command]
                                [/command]
                            [/option]
                            {POTGIVE_OPTION (items/potion-red.png) heal 1 2}
                            {POTGIVE_OPTION (items/potion-grey.png) speed 1 2}
                            {POTGIVE_OPTION (items/potion-blue.png) intelligence 1 2}
                            {POTGIVE_OPTION (items/potion-yellow.png) strength 1 2}
                            {POTGIVE_OPTION (items/potion-poison.png) poison 1 2}
                        [/message]
                    [/command]
                [/option]
                [option]
                    message= _ {MENU_IMG_TXT ($stored_side_3.image) ($stored_side_3.name)}
                    [show_if]
                        [variable]  
                            name=player_3
                            equals=yes
                        [/variable]
                    [/show_if]
                    [command]
                        [message]
                            speaker=unit
                            message= _ "What potion does $stored_side_3.name| deserve?" + {POTION_INFO}
                            [option]
                                message= _ "None"
                                [command]
                                [/command]
                            [/option]
                            {POTGIVE_OPTION (items/potion-red.png) heal 1 3}
                            {POTGIVE_OPTION (items/potion-grey.png) speed 1 3}
                            {POTGIVE_OPTION (items/potion-blue.png) intelligence 1 3}
                            {POTGIVE_OPTION (items/potion-yellow.png) strength 1 3}
                            {POTGIVE_OPTION (items/potion-poison.png) poison 1 3}
                        [/message]
                    [/command]
                [/option]
            [/message]
        [/command]
    [/option]
#enddef

#define GIVE_POTION_2
    [option]
        message= _ "Give potion"
        [show_if]
            [variable]
                name=side_number
                equals=2
            [/variable]
            [variable]
                name=thw_players.length
                greater_than=1
            [/variable]
            [variable]
                name=2total_potions
                greater_than=0
            [/variable]
            [have_unit]
                x=$x1
                y=$y1
                canrecruit=yes
                side=2
            [/have_unit]
        [/show_if]
        [command]
			{THW_STORE_PLAYER_INFO}
            [message]
                speaker=unit
                message= _ "Who deserves a potion?"
                [option]
                    message= _ "Nobody"
                    [command]
                    [/command]
                [/option]
                [option]
                    message= _ {MENU_IMG_TXT $stored_side_1.image ($stored_side_1.name)}
                    [show_if]
                        [variable]
                            name=player_1
                            equals=yes
                        [/variable] 
                    [/show_if]
                    [command]
                        [message]
                            speaker=unit
                            message= _ "What potion does $stored_side_1.name| deserve?" + {POTION_INFO}
                            [option]
                                message= _ "None"
                                [command]
                                [/command]
                            [/option]
                            {POTGIVE_OPTION (items/potion-red.png) heal 2 1}
                            {POTGIVE_OPTION (items/potion-grey.png) speed 2 1}
                            {POTGIVE_OPTION (items/potion-blue.png) intelligence 2 1}
                            {POTGIVE_OPTION (items/potion-yellow.png) strength 2 1}
                            {POTGIVE_OPTION (items/potion-poison.png) poison 2 1}
                        [/message]
                    [/command]
                [/option]
                [option]
                    message= _ {MENU_IMG_TXT ($stored_side_3.image) ($stored_side_3.name)}
                    [show_if]
                        [variable]  
                            name=player_3
                            equals=yes
                        [/variable]
                    [/show_if]
                    [command]
                        [message]
                            speaker=unit
                            message= _ "What potion does $stored_side_3.name| deserve?" + {POTION_INFO}
                            [option]
                                message= _ "None"
                                [command]
                                [/command]
                            [/option]
                            {POTGIVE_OPTION (items/potion-red.png) heal 2 3}
                            {POTGIVE_OPTION (items/potion-grey.png) speed 2 3}
                            {POTGIVE_OPTION (items/potion-blue.png) intelligence 2 3}
                            {POTGIVE_OPTION (items/potion-yellow.png) strength 2 3}
                            {POTGIVE_OPTION (items/potion-poison.png) poison 2 3}
                        [/message]
                    [/command]
                [/option]
            [/message]
        [/command]
    [/option]
#enddef

#define GIVE_POTION_3
    [option]
        message= _ "Give potion"
        [show_if]
            [variable]
                name=side_number
                equals=3
            [/variable]
            [variable]
                name=thw_players.length
                greater_than=1
            [/variable]
            [variable]
                name=3total_potions
                greater_than=0
            [/variable]
            [have_unit]
                x=$x1
                y=$y1
                canrecruit=yes
                side=3
            [/have_unit]
        [/show_if]
        [command]
			{THW_STORE_PLAYER_INFO}
            [message]
                speaker=unit
                message= _ "Who deserves a potion?"
                [option]
                    message= _ "Nobody"
                    [command]
                    [/command]
                [/option]
                [option]
                    message= _ {MENU_IMG_TXT $stored_side_1.image ($stored_side_1.name)}
                    [show_if]
                        [variable]
                            name=player_1
                            equals=yes
                        [/variable] 
                    [/show_if]
                    [command]
                        [message]
                            speaker=unit
                            message= _ "What potion does $stored_side_1.name| deserve?" + {POTION_INFO}
                            [option]
                                message= _ "None"
                                [command]
                                [/command]
                            [/option]
                            {POTGIVE_OPTION (items/potion-red.png) heal 3 1}
                            {POTGIVE_OPTION (items/potion-grey.png) speed 3 1}
                            {POTGIVE_OPTION (items/potion-blue.png) intelligence 3 1}
                            {POTGIVE_OPTION (items/potion-yellow.png) strength 3 1}
                            {POTGIVE_OPTION (items/potion-poison.png) poison 3 1}
                        [/message]
                    [/command]
                [/option]
                [option]
                    message= _ {MENU_IMG_TXT $stored_side_2.image ($stored_side_2.name)}
                    [show_if]
                        [variable]
                            name=player_2
                            equals=yes
                        [/variable]
                    [/show_if]
                    [command]
                        [message]
                            speaker=unit
                            message= _ "What potion does $stored_side_2.name| deserve?" + {POTION_INFO}
                            [option]
                                message= _ "None"
                                [command]
                                [/command]
                            [/option]
                            {POTGIVE_OPTION (items/potion-red.png) heal 3 2}
                            {POTGIVE_OPTION (items/potion-grey.png) speed 3 2}
                            {POTGIVE_OPTION (items/potion-blue.png) intelligence 3 2}
                            {POTGIVE_OPTION (items/potion-yellow.png) strength 3 2}
                            {POTGIVE_OPTION (items/potion-poison.png) poison 3 2}
                        [/message]
                    [/command]
                [/option]
            [/message]
        [/command]
    [/option]
#enddef

#define ALL_POTION_GIVE_MENUS
    {GIVE_POTION_1}
    {GIVE_POTION_2}
    {GIVE_POTION_3}
#enddef

#define POTION_INFO
"
<b>Total Potions: $$side_number|total_potions</b>" + "
<span foreground='red'>Health Potions: $$side_number|heal_potions</span>" + "
<span foreground='gray'>Speed Potions: $$side_number|speed_potions</span>" + "
<span foreground='blue'>Intelligence Potions: $$side_number|intelligence_potions</span>" + "
<span foreground='yellow'>Strength Potions: $$side_number|strength_potions</span>" + "
<span foreground='green'>Poison Potions: $$side_number|poison_potions</span>"
#enddef
                                 
#define POTION_MENUS
	[event]
		name=start
		[set_menu_item]
			id=potion_menus
			description= _ "Potions"
			image=misc/icon-amla-tough.png
			[show_if]
				[variable]
					name=$side_number|total_potions
					greater_than=0
				[/variable]
				[and]
					[variable]
						name=side_number
						equals=1
					[/variable]
					[or]
						[variable]
							name=side_number
							equals=2
						[/variable]
					[/or]
					[or]
						[variable]
							name=side_number
							equals=3
						[/variable]
					[/or]
				[/and]
			[/show_if]
			[command]
				[message]
					speaker=narrator
					side_for=$side_number
					message={POTION_INFO}
				    {USE_POTION_MENU}
				    {ALL_POTION_GIVE_MENUS}	
					[option]
						message= _ "<b>None.</b>"
						[command]
						[/command]
					[/option]
				[/message]
			[/command]
		[/set_menu_item]
	[/event]
#enddef

# All complete menus go into this

#define THW_ALL_MENUS
    {GOLD_GIVE}
    {UNIT_GIVE}
    {POTION_MENUS}
#enddef
